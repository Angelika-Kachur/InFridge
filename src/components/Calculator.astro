---
---

<div class="glass-card animate-fade">
  <h2 class="text-gradient">Personal Nutrition Calculator</h2>
  <p style="margin-bottom: 2rem; color: var(--text-muted);">Enter your data for a personalized nutrition plan based on 2020-2025 guidelines.</p>

  <form id="nutrition-form" class="grid-form">
    <div class="form-group">
      <label for="sex">Sex</label>
      <select id="sex" required>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
    </div>

    <div class="form-group">
      <label for="age">Age (years)</label>
      <input type="number" id="age" min="15" max="100" value="30" required />
    </div>

    <div class="form-group">
      <label for="weight">Weight (kg)</label>
      <input type="number" id="weight" min="30" max="300" value="75" required />
    </div>

    <div class="form-group">
      <label for="height">Height (cm)</label>
      <input type="number" id="height" min="100" max="250" value="175" required />
    </div>

    <div class="form-group">
      <label for="activity">Activity Level</label>
      <select id="activity" required>
        <option value="1.2">Sedentary (Little/no exercise)</option>
        <option value="1.375" selected>Lightly Active (1-3 days/week)</option>
        <option value="1.55">Moderately Active (3-5 days/week)</option>
        <option value="1.725">Very Active (6-7 days/week)</option>
        <option value="1.9">Extra Active (Athletic/Physical job)</option>
      </select>
    </div>

    <div class="form-group">
      <label for="goal">Health Goal</label>
      <select id="goal" required>
        <option value="maintain">Maintain Weight</option>
        <option value="lose">Weight Loss</option>
        <option value="gain">Weight Gain</option>
        <option value="sugar">Lower Sugar/Pre-diabetic</option>
        <option value="cholesterol">Lower LDL Cholesterol</option>
        <option value="pressure">Lower Blood Pressure</option>
      </select>
    </div>

    <button type="submit" class="btn-primary" style="grid-column: 1 / -1; margin-top: 1rem;">Calculate My Needs</button>
  </form>

  <div id="results" class="results-container hidden">
    <div class="results-grid">
      <div class="result-tile">
        <span class="label">Daily kcal</span>
        <span class="value" id="res-kcal">-</span>
      </div>
      <div class="result-tile">
        <span class="label">Proteins</span>
        <span class="value" id="res-protein">-</span>
        <span class="unit">grams</span>
      </div>
      <div class="result-tile">
        <span class="label">Carbs (Complex Focus)</span>
        <span class="value" id="res-carbs">-</span>
        <span class="unit">grams</span>
      </div>
      <div class="result-tile">
        <span class="label">Fats</span>
        <span class="value" id="res-fats">-</span>
        <span class="unit">grams</span>
      </div>
      <div class="result-tile">
        <span class="label">Max Saturated Fat</span>
        <span class="value" id="res-sat-fat">-</span>
        <span class="unit">grams</span>
      </div>
    </div>

    <div class="missions-container">
      <h3 class="mission-title">üéØ Your Daily Missions</h3>
      <div id="mission-list" class="mission-list">
        <!-- Missions generated by JS -->
      </div>
    </div>

    <div id="food-options" class="food-options-container hidden">
      <!-- Food options generated by JS -->
    </div>

    <div id="additional-info" class="additional-info">
      <!-- Recommendations based on goal will appear here -->
    </div>
  </div>
</div>

<style>
  .grid-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
  }

  .results-container {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--glass-border);
    animation: fadeIn 0.5s ease-out;
  }

  .hidden {
    display: none;
  }

  .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .result-tile {
    background: rgba(255, 255, 255, 0.05);
    padding: 1.5rem;
    border-radius: 16px;
    text-align: center;
    border: 1px solid var(--glass-border);
  }

  .result-tile .label {
    display: block;
    font-size: 0.8rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
  }

  .result-tile .value {
    display: block;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary);
  }

  .result-tile .unit {
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .additional-info {
    font-size: 0.95rem;
    padding: 1.5rem;
    border-radius: 12px;
    background: rgba(16, 185, 129, 0.1);
    border-left: 4px solid var(--secondary);
    margin-top: 2rem;
  }

  /* Missions styles */
  .missions-container {
    margin-top: 2.5rem;
  }

  .mission-title {
    font-size: 1.2rem;
    margin-bottom: 1rem;
    color: var(--text);
  }

  .mission-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
  }

  .mission-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    transition: var(--transition);
  }

  .mission-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
  }

  .mission-icon {
    font-size: 1.5rem;
  }

  .mission-details h4 {
    font-size: 0.95rem;
    margin-bottom: 0.2rem;
  }

  .mission-details p {
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  /* Food Options */
  .food-options-container {
    margin-top: 3rem;
  }
  
  .food-options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    margin-top: 1.5rem;
  }

  .food-category {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .food-category h4 {
    color: var(--primary);
    margin-bottom: 0.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .food-category .target-pill {
    font-size: 0.75rem;
    background: rgba(79, 70, 229, 0.2);
    padding: 0.2rem 0.6rem;
    border-radius: 20px;
    color: var(--text);
  }

  .food-list {
    list-style: none;
    margin-top: 1rem;
    font-size: 0.9rem;
  }

  .food-list li {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .food-list li:last-child {
    border-bottom: none;
  }

  .food-list span:last-child {
    color: var(--text-muted);
    font-size: 0.85rem;
  }
</style>

<script>
  const form = document.getElementById('nutrition-form');
  const resultsDiv = document.getElementById('results');

  form?.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const sex = (document.getElementById('sex') as HTMLSelectElement).value;
    const age = parseInt((document.getElementById('age') as HTMLInputElement).value);
    const weight = parseFloat((document.getElementById('weight') as HTMLInputElement).value);
    const height = parseFloat((document.getElementById('height') as HTMLInputElement).value);
    const activity = parseFloat((document.getElementById('activity') as HTMLSelectElement).value);
    const goal = (document.getElementById('goal') as HTMLSelectElement).value;

    // Mifflin-St Jeor Equation
    let bmr = 0;
    if (sex === 'male') {
      bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
    } else {
      bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
    }

    let tdee = bmr * activity;
    let targetKcal = tdee;

    // Adjust based on goal
    if (goal === 'lose') targetKcal -= 500;
    if (goal === 'gain') targetKcal += 500;
    if (goal === 'sugar' || goal === 'cholesterol' || goal === 'pressure') targetKcal -= 200; // Slight deficit for health improvements

    // Macro distributions
    let pRatio = 0.25; // 25% protein
    let fRatio = 0.25; // 25% fat
    let cRatio = 0.50; // 50% carbs
    let satFatRatio = 0.10; // Default <10%

    let infoText = "";

    if (goal === 'sugar') {
      pRatio = 0.30;
      fRatio = 0.35;
      cRatio = 0.35;
      satFatRatio = 0.08;
      infoText = "<strong>Health Tip:</strong> Focus on Low Glycemic Index (GI) carbs like legumes, oats, and leafy greens. Avoid simple sugars and refined white flour.";
    } else if (goal === 'cholesterol') {
      pRatio = 0.25;
      fRatio = 0.25; // Keep low, but focus on quality
      cRatio = 0.50;
      satFatRatio = 0.06; // <6% for heart health
      infoText = "<strong>Heart Health:</strong> Limit saturated fats (butter, fatty meats) to &lt;6% of total kcal. Increase soluble fiber (beans, apples) to lower LDL.";
    } else if (goal === 'pressure') {
      pRatio = 0.20;
      fRatio = 0.30;
      cRatio = 0.50;
      satFatRatio = 0.07;
      infoText = "<strong>DASH Principle:</strong> Prioritize high-potassium foods (bananas, potatoes, spinach) and magnesium. Keep sodium below 1,500mg daily.";
    } else {
      infoText = "<strong>Wellness Recommendation:</strong> Drink at least 2L of water daily and aim for 5 servings of vegetables as per UK NHS guidelines.";
    }

    const proteinGrams = Math.round((targetKcal * pRatio) / 4);
    const fatGrams = Math.round((targetKcal * fRatio) / 9);
    const carbGrams = Math.round((targetKcal * cRatio) / 4);
    const satFatGrams = Math.round((targetKcal * satFatRatio) / 9);

    // Calculate Portions
    const proteinPortions = Math.round(proteinGrams / 25); // ~25g per palm/breast
    const carbPortions = Math.round(carbGrams / 40); // ~40g per fist/cup
    const fatPortions = Math.round(fatGrams / 12); // ~12g per thumb/spoon
    const waterCups = Math.max(8, Math.round(weight * 0.033 * 4)); // Rough estimate: 33ml/kg converted to cups (250ml)

    // Generate Missions HTML
    let missionsHtml = `
      <div class="mission-card">
        <div class="mission-icon">ü•©</div>
        <div class="mission-details">
          <h4>Eat ${proteinPortions} Palms of Protein</h4>
          <p>~25g each (Chicken breast, Tofu block)</p>
        </div>
      </div>
      <div class="mission-card">
        <div class="mission-icon">üçö</div>
        <div class="mission-details">
          <h4>Eat ${carbPortions} Fists of Carbs</h4>
          <p>~40g each (Rice, Potato, Oats)</p>
        </div>
      </div>
      <div class="mission-card">
        <div class="mission-icon">ü•ë</div>
        <div class="mission-details">
          <h4>limit to ${fatPortions} Thumbs of Fat</h4>
          <p>~12g each (Oils, Nuts, Butter)</p>
        </div>
      </div>
      <div class="mission-card">
        <div class="mission-icon">ü•¨</div>
        <div class="mission-details">
          <h4>Eat 5+ Vegetable Servings</h4>
          <p>80g is one serving (1 handful)</p>
        </div>
      </div>
      <div class="mission-card">
        <div class="mission-icon">üíß</div>
        <div class="mission-details">
          <h4>Drink ${waterCups} Glasses</h4>
          <p>~250ml per glass. Stay hydrated!</p>
        </div>
      </div>
    `;

    if (goal === 'sugar') {
      missionsHtml += `
        <div class="mission-card" style="border-color: var(--accent);">
          <div class="mission-icon">üö´</div>
          <div class="mission-details">
            <h4>No sugary drinks</h4>
            <p>0g added sugar from beverages.</p>
          </div>
        </div>
      `;
    }

    if (goal === 'cholesterol') {
      missionsHtml += `
         <div class="mission-card" style="border-color: var(--accent);">
          <div class="mission-icon">üêü</div>
          <div class="mission-details">
            <h4>Eat Oily Fish x2/week</h4>
            <p>Salmon/Mackerel for Omega-3.</p>
          </div>
        </div>
      `;
    }

    const missionListDiv = document.getElementById('mission-list');
    if (missionListDiv) missionListDiv.innerHTML = missionsHtml;

    // --- Generate Food Options ---
    const proteinFoods = [
      { name: "Chicken Breast", amount: "100g raw / 1 small breast" },
      { name: "Tofu / Tempeh", amount: "150g block" },
      { name: "White Fish", amount: "120g raw fillet" },
      { name: "Eggs", amount: "2 large eggs (whole)" },
      { name: "Greek Yogurt", amount: "200g (small tub)" },
      { name: "Lean Beef", amount: "100g raw mince" },
      { name: "Protein Powder", amount: "1 scoop (30g)" }
    ];

    const carbFoods = [
      { name: "Rice (White/Brown)", amount: "40g dry / 120g cooked" },
      { name: "Pasta", amount: "50g dry / 1 cup cooked" },
      { name: "Rolled Oats", amount: "40g dry" },
      { name: "Potato", amount: "1 med. (150g)" },
      { name: "Sweet Potato", amount: "1 med. (150g)" },
      { name: "Bread (Wholegrain)", amount: "2 slices" },
      { name: "Banana", amount: "1 large" }
    ];

    const fatFoods = [
      { name: "Avocado", amount: "1/2 medium" },
      { name: "Nuts (Original)", amount: "20g (small handful)" },
      { name: "Olive Oil", amount: "1 tbsp" },
      { name: "Butter", amount: "10g (pat)" },
      { name: "Chia Seeds", amount: "2 tbsp" },
      { name: "Cheese", amount: "30g (matchbox)" },
      { name: "Peanut Butter", amount: "1 heaped tsp" }
    ];

    const generateList = (items: {name: string, amount: string}[]) => {
      return items.map(item => `<li><span>${item.name}</span><span>${item.amount}</span></li>`).join('');
    };

    const foodHtml = `
      <h3 style="text-align: center;">üçΩÔ∏è Build Your Daily Menu</h3>
      <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Mix and match these options to hit your daily targets.</p>
      
      <div class="food-options-grid">
        <div class="food-category" style="border-top: 4px solid var(--primary);">
          <h4>Proteins <span class="target-pill">Target: ${proteinPortions} / day</span></h4>
          <p style="font-size: 0.8rem; color: var(--text-muted);">Each item below counts as <strong>1 Portion</strong> (~25g)</p>
          <ul class="food-list">
            ${generateList(proteinFoods)}
          </ul>
        </div>

        <div class="food-category" style="border-top: 4px solid var(--accent);">
          <h4>Carbs <span class="target-pill">Target: ${carbPortions} / day</span></h4>
          <p style="font-size: 0.8rem; color: var(--text-muted);">Each item below counts as <strong>1 Portion</strong> (~40g)</p>
          <ul class="food-list">
            ${generateList(carbFoods)}
          </ul>
        </div>

        <div class="food-category" style="border-top: 4px solid var(--secondary);">
          <h4>Fats <span class="target-pill">Limit: ${fatPortions} / day</span></h4>
          <p style="font-size: 0.8rem; color: var(--text-muted);">Each item below counts as <strong>1 Portion</strong> (~12g)</p>
          <ul class="food-list">
            ${generateList(fatFoods)}
          </ul>
        </div>
      </div>
    `;

    const foodDiv = document.getElementById('food-options');
    if (foodDiv) {
      foodDiv.innerHTML = foodHtml;
      foodDiv.classList.remove('hidden');
    }

    // Update UI
    (document.getElementById('res-kcal')!).innerText = Math.round(targetKcal).toString();
    (document.getElementById('res-protein')!).innerText = proteinGrams.toString();
    (document.getElementById('res-carbs')!).innerText = carbGrams.toString();
    (document.getElementById('res-fats')!).innerText = fatGrams.toString();
    (document.getElementById('res-sat-fat')!).innerText = satFatGrams.toString();
    
    const infoContainer = document.getElementById('additional-info');
    if (infoContainer) infoContainer.innerHTML = infoText;
    
    resultsDiv?.classList.remove('hidden');
    resultsDiv?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  });
</script>
